# Load Server Types Text

A function for parsing `types.md` files back into structured type metadata. This is the reverse operation of [`syncTypes`](../sync-types/page.mdx) - it reads markdown and reconstructs the `TypesMeta[]` array.

---

## Overview

`loadServerTypesText` parses a `types.md` file that was previously generated by `syncTypes`. It reconstructs:

- Component, hook, function, and raw type metadata
- Props, parameters, data attributes, and CSS variables tables
- External types section
- Variant metadata (embedded as comments)

This is useful for:

- Reading pre-generated documentation without re-running TypeScript analysis
- Testing and debugging the type generation pipeline
- Building tools that consume type documentation

---

## Usage

### Basic Usage

```typescript
import { loadServerTypesText } from '@mui/internal-docs-infra/pipeline/loadServerTypesText';

// Load types from a file URL
const result = await loadServerTypesText('file:///absolute/path/to/types.md');

// Access the parsed types
console.log(result.allTypes); // TypesMeta[]
console.log(result.variantData); // Record<string, VariantData>
console.log(result.externalTypes); // Record<string, string>
```

### Parsing Markdown Directly

```typescript
import { parseTypesMarkdown } from '@mui/internal-docs-infra/pipeline/loadServerTypesText';

const markdown = `# Button API

## API Reference

### Button

A clickable button component

**Button Props:**

| Prop | Type | Default | Description |
| --- | --- | --- | --- |
| disabled | \`boolean\` | \`false\` | Whether the button is disabled |
| onClick* | \`() => void\` | - | Click handler |
`;

const result = parseTypesMarkdown(markdown);
console.log(result.allTypes[0]); // { type: 'component', name: 'Button', data: {...} }
```

---

## Functions

### loadServerTypesText

Loads and parses a `types.md` file from a file URL.

```typescript
async function loadServerTypesText(fileUrl: string): Promise<LoadServerTypesTextResult>;
```

**Parameters:**

| Parameter | Type     | Description                          |
| --------- | -------- | ------------------------------------ |
| fileUrl   | `string` | A `file://` URL to the types.md file |

### parseTypesMarkdown

Parses markdown content directly into type metadata. Exported for testing.

```typescript
function parseTypesMarkdown(content: string): LoadServerTypesTextResult;
```

**Parameters:**

| Parameter | Type     | Description                       |
| --------- | -------- | --------------------------------- |
| content   | `string` | The raw markdown content to parse |

---

## Markdown Format

The parser expects markdown in the format generated by `syncTypes`:

### Type Sections

Each type is defined by an H3 heading (`###`) followed by optional description and tables:

```markdown
### ComponentName

Optional description paragraph.

**ComponentName Props:**

| Prop       | Type      | Default     | Description                    |
| ---------- | --------- | ----------- | ------------------------------ |
| propName   | `string`  | `"default"` | Prop description               |
| required\* | `boolean` | -           | Required prop (marked with \*) |
```

### Type Detection

The parser determines type kind based on content:

- **Hook**: Name starts with `use`
- **Component**: Has props, data attributes, or CSS variables
- **Function**: Has parameters, properties, or return value
- **Raw**: Has a code block definition

### Tables

The parser recognizes these table formats:

- **Props**: `| Prop | Type | Default | Description |`
- **Parameters**: `| Parameter | Type | Default | Description |`
- **Properties**: `| Property | Type | Default | Description |` (for hooks/functions with a single anonymous object parameter)
- **Data Attributes**: `| Attribute | Type | Description |`
- **CSS Variables**: `| Variable | Type | Description |`
- **Return Value**: `| Property | Type | Description |`

### External Types

External types are parsed from the "External Types" H2 section:

```markdown
## External Types

### TypeName

\`\`\`typescript
type TypeName = string | number;
\`\`\`
```

### Embedded Metadata

Variant and type name mappings are embedded as HTML comments at the end of the file:

```markdown
[//]: # 'variantTypes: {"Default":["Button","ButtonProps"]}'
[//]: # 'typeNameMap: {"ButtonProps":"Button.Props"}'
```

---

## Types

import { TypesLoadServerTypesText, TypesLoadServerTypesTextAdditional } from './types';

### `loadServerTypesText`

<TypesLoadServerTypesText.loadServerTypesText />

[See Types](./types.md#loadServerTypesText)

### `organizeTypesByExport`

<TypesLoadServerTypesText.organizeTypesByExport />

[See Types](./types.md#organizeTypesByExport)

## Additional Types

<TypesLoadServerTypesTextAdditional />

---

## Related

- [`syncTypes`](../sync-types/page.mdx) - Generates the `types.md` files that this function parses
- [`loadServerTypes`](../load-server-types/page.mdx) - Full pipeline that calls `syncTypes` and applies highlighting
