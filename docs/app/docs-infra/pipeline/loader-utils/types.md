# Loader Utils

[//]: types.ts '<-- Autogenerated By (do not edit the following markdown directly), run: pnpm docs:validate docs-infra/pipeline/loader-utils'

## API Reference

### DirectoryReader

**Parameters:**

| Parameter | Type     | Default | Description |
| :-------- | :------- | :------ | :---------- |
| path      | `string` | -       | -           |

**Return Value:**

```tsx
type ReturnValue = Promise<DirectoryEntry[]>;
```

### externalsToPackages

**Parameters:**

| Parameter | Type       | Default | Description |
| :-------- | :--------- | :------ | :---------- |
| externals | `string[]` | -       | -           |

**Return Value:**

```tsx
type ReturnValue = Record<string, true>;
```

### extractNameAndSlugFromUrl

Extracts and formats a name and slug from a URL path

**Parameters:**

| Parameter | Type     | Default | Description                                                  |
| :-------- | :------- | :------ | :----------------------------------------------------------- |
| url       | `string` | -       | The URL to extract from (can be file:// URL or regular path) |

**Return Value:**

Object containing the formatted name and slug

| Property | Type     | Description |
| :------- | :------- | :---------- |
| `name`   | `string` | -           |
| `slug`   | `string` | -           |

### fileUrlToPortablePath

Converts a file:// URL to a portable path format that can be used with path-module (POSIX-only).

This function is designed to work with isomorphic code that uses path-module,
which only supports POSIX paths. The key insight is that by stripping the `file://`
prefix and normalizing backslashes to forward slashes, we get a path that:

- On Unix: `/home/user/file.ts` - works directly with path-module
- On Windows: `/C:/Users/file.ts` - also works with path-module because it starts with `/`

The resulting path is NOT a valid filesystem path on Windows, but it's a valid
POSIX-style path for path manipulation. Use `fileURLToPath` from the `url` module
when you need to access the actual filesystem.

**Parameters:**

| Parameter | Type     | Default | Description                                           |
| :-------- | :------- | :------ | :---------------------------------------------------- |
| fileUrl   | `string` | -       | A file:// URL or absolute path (with forward slashes) |

**Return Value:**

A portable path starting with `/` that works with path-module

```tsx
type ReturnValue = string;
```

### getFileNameFromUrl

Extracts the filename and extension from a URL or file path.
This function is isomorphic and works in both Node.js and browser environments.
It properly handles compound extensions like .module.css, .d.ts, .test.js, etc.

**Parameters:**

| Parameter | Type     | Default | Description                                       |
| :-------- | :------- | :------ | :------------------------------------------------ |
| url       | `string` | -       | The URL or file path to extract the filename from |

**Return Value:**

An object containing the filename and extension

| Property    | Type     | Description |
| :---------- | :------- | :---------- |
| `fileName`  | `string` | -           |
| `extension` | `string` | -           |

### getLanguageFromExtension

Gets the language name from a file extension.

**Parameters:**

| Parameter | Type     | Default | Description                               |
| :-------- | :------- | :------ | :---------------------------------------- |
| extension | `string` | -       | The file extension (e.g., '.tsx', '.css') |

**Return Value:**

The language name or undefined if not recognized

```tsx
type ReturnValue = string | undefined;
```

### isJavaScriptModule

Checks if a file path or import path represents a JavaScript/TypeScript module

**Parameters:**

| Parameter | Type     | Default | Description                           |
| :-------- | :------- | :------ | :------------------------------------ |
| path      | `string` | -       | The file path or import path to check |

**Return Value:**

true if it's a JS/TS module, false otherwise

```tsx
type ReturnValue = boolean;
```

### normalizeLanguage

Normalizes a language name to its canonical form.
This handles aliases like 'js' -> 'javascript', 'ts' -> 'typescript'.

**Parameters:**

| Parameter | Type     | Default | Description                |
| :-------- | :------- | :------ | :------------------------- |
| language  | `string` | -       | The language name or alias |

**Return Value:**

The canonical language name, or the input if not a known alias

```tsx
type ReturnValue = string;
```

### parseImportsAndComments

Parse import and export-from statements from JavaScript/TypeScript/CSS code.

This function analyzes source code to extract all import and export-from statements,
categorizing them as either relative imports (local files) or external imports (packages).
It supports JavaScript, TypeScript, CSS, and MDX files.

Comment processing (stripping/collecting) is performed during import parsing
for efficiency. Since we must already parse the entire file character-by-character
to correctly identify imports while avoiding false positives in strings, comments,
and template literals, it's most efficient to handle comment processing in this
same pass rather than requiring separate parsing steps.

The function accepts file:// URLs or file paths and converts them internally to a
portable path format that works cross-platform. Resolved import paths are returned
in the same portable format (forward slashes, starting with /).

**Parameters:**

| Parameter | Type                                                                        | Default | Description                                                                                       |
| :-------- | :-------------------------------------------------------------------------- | :------ | :------------------------------------------------------------------------------------------------ |
| code      | `string`                                                                    | -       | The source code to parse                                                                          |
| fileUrl   | `string`                                                                    | -       | The file URL (file:// protocol) or path, used to determine file type and resolve relative imports |
| options?  | `{ removeCommentsWithPrefix?: string[]; notableCommentsPrefix?: string[] }` | -       | Optional configuration for comment processing                                                     |

**Return Value:**

Promise resolving to parsed import data, optionally including processed code and collected comments

```tsx
type ReturnValue = Promise<ImportsAndComments>;
```

### portablePathToFileUrl

Converts a portable path back to a file:// URL.

This is the inverse of `fileUrlToPortablePath`. It takes a portable path
(which always starts with `/`) and converts it back to a proper file:// URL.

**Parameters:**

| Parameter    | Type     | Default | Description                       |
| :----------- | :------- | :------ | :-------------------------------- |
| portablePath | `string` | -       | A portable path starting with `/` |

**Return Value:**

A file:// URL

```tsx
type ReturnValue = string;
```

### processRelativeImports

Processes imports based on the specified storage mode, automatically handling
source rewriting when needed (e.g., for 'flat' mode). Works for both JavaScript and simple file types.

**Parameters:**

| Parameter         | Type                                                                                               | Default | Description                                                                     |
| :---------------- | :------------------------------------------------------------------------------------------------- | :------ | :------------------------------------------------------------------------------ |
| source            | `string`                                                                                           | -       | The original source code                                                        |
| importResult      | `Record<string, { url: string; names: string[]; positions?: ({ start: number; end: number })[] }>` | -       | The result from parseImports                                                    |
| storeAt           | `StoreAtMode`                                                                                      | -       | How to process the imports                                                      |
| isJsFile?         | `boolean`                                                                                          | -       | Whether this is a JavaScript file (false = basic processing for CSS/JSON/etc.)  |
| resolvedPathsMap? | `Map<string, string>`                                                                              | -       | Map from import paths to resolved file paths (only needed for JavaScript files) |

**Return Value:**

Object with processed source and extraFiles mapping

| Property          | Type                     | Description |
| :---------------- | :----------------------- | :---------- |
| `processedSource` | `string`                 | -           |
| `extraFiles`      | `Record<string, string>` | -           |

### removeImports

Removes entire import statements for the specified import paths.
This removes the full import line, not just the path.

**Parameters:**

| Parameter           | Type                                                                | Default | Description                                                          |
| :------------------ | :------------------------------------------------------------------ | :------ | :------------------------------------------------------------------- |
| source              | `string`                                                            | -       | The source code to process                                           |
| importPathsToRemove | `Set<string>`                                                       | -       | Set of import paths whose entire import statements should be removed |
| importResult        | `Record<string, { positions: ({ start: number; end: number })[] }>` | -       | Import result with position data                                     |

**Return Value:**

The source code with import statements removed

```tsx
type ReturnValue = string;
```

### resolveImportResult

Resolves import result by separating JavaScript modules from static assets,
only resolving JavaScript modules and returning a combined map.
This function uses the new type-aware resolveModulePath function internally.

**Parameters:**

| Parameter     | Type                                                                                                                       | Default | Description                                         |
| :------------ | :------------------------------------------------------------------------------------------------------------------------- | :------ | :-------------------------------------------------- |
| importResult  | `Record<string, { url: string; names: string[]; includeTypeDefs?: true; positions?: ({ start: number; end: number })[] }>` | -       | The result from parseImports containing all imports |
| readDirectory | `((path: string) => Promise<DirectoryEntry[]>)`                                                                            | -       | Function to read directory contents                 |
| options?      | `ResolveModulePathOptions`                                                                                                 | -       | Configuration options for module resolution         |

**Return Value:**

Promise\<Map\<string, string>> - Map from import path to resolved file path

```tsx
type ReturnValue = Promise<Map<string, string>>;
```

### resolveModulePath

Resolves a module path by reading directory contents to find matching files.
This is more efficient than checking each file individually with stat calls.

Given a path like `file:///Code/mui-public/packages/docs-infra/docs/app/components/code-highlighter/demos/code/BasicCode`,
this function will try to find the actual file by checking for:

- `BasicCode.ts`, `BasicCode.tsx`, `BasicCode.js`, `BasicCode.jsx`
- `BasicCode/index.ts`, `BasicCode/index.tsx`, `BasicCode/index.js`, `BasicCode/index.jsx`

**Parameters:**

| Parameter        | Type                                            | Default | Description                                                                           |
| :--------------- | :---------------------------------------------- | :------ | :------------------------------------------------------------------------------------ |
| moduleUrl        | `string`                                        | -       | The module URL to resolve (file:// URL or portable path, without file extension)      |
| readDirectory    | `((path: string) => Promise<DirectoryEntry[]>)` | -       | Function to read directory contents                                                   |
| options?         | `ResolveModulePathOptions`                      | -       | Configuration options                                                                 |
| includeTypeDefs? | `boolean`                                       | -       | If true, returns both import and typeImport paths with different extension priorities |

**Return Value:**

Promise\<string | TypeAwareResolveResult> - The resolved file:// URL(s)

```tsx
type ReturnValue = Promise<string | TypeAwareResolveResult>;
```

### resolveModulePaths

Resolves multiple module paths efficiently by grouping them by directory
and performing batch directory lookups.

**Parameters:**

| Parameter     | Type                                            | Default | Description                                                |
| :------------ | :---------------------------------------------- | :------ | :--------------------------------------------------------- |
| modulePaths   | `string[]`                                      | -       | Array of module paths to resolve (without file extensions) |
| readDirectory | `((path: string) => Promise<DirectoryEntry[]>)` | -       | Function to read directory contents                        |
| options?      | `ResolveModulePathOptions`                      | -       | Configuration options                                      |

**Return Value:**

Promise\<Map\<string, string>> - Map from input path to resolved file path

```tsx
type ReturnValue = Promise<Map<string, string>>;
```

### resolveVariantPaths

Resolves variant paths from a variants object mapping variant names to their file paths.
This function extracts the paths, resolves them using resolveModulePaths, and returns
a map from variant name to resolved file URL.

**Parameters:**

| Parameter     | Type                                            | Default | Description                                      |
| :------------ | :---------------------------------------------- | :------ | :----------------------------------------------- |
| variants      | `Record<string, string>`                        | -       | Object mapping variant names to their file paths |
| readDirectory | `((path: string) => Promise<DirectoryEntry[]>)` | -       | Function to read directory contents              |
| options?      | `ResolveModulePathOptions`                      | -       | Configuration options for module resolution      |

**Return Value:**

Promise\<Map\<string, string>> - Map from variant name to resolved file URL

```tsx
type ReturnValue = Promise<Map<string, string>>;
```

### rewriteImports

Efficiently rewrites import paths using position data.
This avoids regex parsing and uses precise position information for replacement.
Works for both JavaScript/TypeScript and CSS imports.

**Parameters:**

| Parameter         | Type                                                                | Default | Description                                        |
| :---------------- | :------------------------------------------------------------------ | :------ | :------------------------------------------------- |
| source            | `string`                                                            | -       | The source code to process                         |
| importPathMapping | `Map<string, string>`                                               | -       | Map from original import paths to new import paths |
| importResult      | `Record<string, { positions: ({ start: number; end: number })[] }>` | -       | Import result with position data                   |

**Return Value:**

The source code with rewritten import paths

```tsx
type ReturnValue = string;
```

### rewriteImportsToNull

Converts import statements to const declarations set to null.
This preserves variable names while removing the actual imports.
Useful when precomputing data that makes the imports unnecessary.

**Parameters:**

| Parameter            | Type                                                                                                                           | Default | Description                                                     |
| :------------------- | :----------------------------------------------------------------------------------------------------------------------------- | :------ | :-------------------------------------------------------------- |
| source               | `string`                                                                                                                       | -       | The source code to process                                      |
| importPathsToRewrite | `Set<string>`                                                                                                                  | -       | Set of import paths whose import statements should be rewritten |
| importResult         | `Record<string, { positions: ({ start: number; end: number })[]; names: ({ name: string; alias?: string; type: string })[] }>` | -       | Import result with position and name data                       |

**Return Value:**

The source code with import statements rewritten to const declarations

```tsx
type ReturnValue = string;
```

## Additional Types

### DirectoryEntry

```typescript
type DirectoryEntry = { name: string; isFile: boolean; isDirectory: boolean };
```

### ExternalImport

Represents an import from an external package (node_modules).

```typescript
type ExternalImport = { names: ImportName[]; positions: ImportPathPosition[] };
```

### ImportName

Represents a single import name with its properties.

```typescript
type ImportName = {
  name: string;
  alias?: string;
  type: 'default' | 'named' | 'namespace';
  isType?: boolean;
};
```

### ImportPathPosition

Represents the position of an import path in the source code.

```typescript
type ImportPathPosition = { start: number; end: number };
```

### ImportsAndComments

The result of parsing import statements from source code.

```typescript
type ImportsAndComments = {
  relative: Record<string, RelativeImport>;
  externals: Record<string, ExternalImport>;
  code?: string;
  comments?: Record<number, string[]>;
};
```

### JAVASCRIPT_MODULE_EXTENSIONS

Default file extensions for JavaScript/TypeScript modules that can be resolved

```typescript
type JAVASCRIPT_MODULE_EXTENSIONS = ['.ts', '.tsx', '.js', '.jsx', '.mdx', '.d.ts'];
```

### languageAliasMap

Maps language aliases to canonical language names.
Used to normalize short language names (e.g., from className like 'language-js')
to their full names.

```typescript
type languageAliasMap = Record<string, string>;
```

### languageMap

Maps file extensions to language names.
These are user-friendly names that can be used in the `language` prop.

```typescript
type languageMap = Record<string, string>;
```

### ProcessImportsResult

```typescript
type ProcessImportsResult = { processedSource: string; extraFiles: Record<string, string> };
```

### RelativeImport

Represents an import from a relative path (starts with ./ or ../).

```typescript
type RelativeImport = {
  url: string;
  names: ImportName[];
  includeTypeDefs?: true;
  positions: ImportPathPosition[];
};
```

### ResolveModulePathOptions

```typescript
type ResolveModulePathOptions = { extensions?: string[] };
```

### StoreAtMode

```typescript
type StoreAtMode = 'canonical' | 'import' | 'flat';
```

### TYPE_IMPORT_EXTENSIONS

Extension priority for type-only imports - prioritize .d.ts first

```typescript
type TYPE_IMPORT_EXTENSIONS = ['.d.ts', '.ts', '.tsx', '.js', '.jsx', '.mdx'];
```

### TypeAwareResolveResult

```typescript
type TypeAwareResolveResult = { import: string; typeImport?: string };
```

### VALUE_IMPORT_EXTENSIONS

Extension priority for value imports - standard priority with .d.ts last

```typescript
type VALUE_IMPORT_EXTENSIONS = ['.ts', '.tsx', '.js', '.jsx', '.mdx', '.d.ts'];
```
