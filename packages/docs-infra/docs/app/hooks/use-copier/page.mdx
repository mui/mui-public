# useCopier

The `useCopier` hook provides robust clipboard copy functionality with success state management, error handling, and customizable callbacks. It's designed for code blocks, buttons, and interactive elements that need copy-to-clipboard functionality.

## Features

- **Flexible content source** - Accepts static strings or dynamic functions
- **Success state tracking** - Provides `recentlySuccessful` state for UI feedback
- **Configurable timeout** - Customizable reset timer for success state
- **Error handling** - Built-in error handling with optional callback
- **Event integration** - Supports additional onClick handlers
- **Memory safe** - Automatic cleanup of timeouts

## API

```typescript
const { copy, recentlySuccessful } = useCopier(contents, options);
```

### Parameters

| Parameter  | Type                                    | Description                                    |
| ---------- | --------------------------------------- | ---------------------------------------------- |
| `contents` | `string \| (() => string \| undefined)` | Static text or function returning text to copy |
| `options`  | `UseCopierOpts`                         | Optional configuration object                  |

### Options

| Option     | Type                                                   | Default | Description                          |
| ---------- | ------------------------------------------------------ | ------- | ------------------------------------ |
| `onCopied` | `() => void`                                           | -       | Callback fired after successful copy |
| `onError`  | `(error: unknown) => void`                             | -       | Callback fired when copy fails       |
| `onClick`  | `(event: React.MouseEvent<HTMLButtonElement>) => void` | -       | Additional click handler             |
| `timeout`  | `number`                                               | `2000`  | Duration (ms) to show success state  |

### Returns

| Property             | Type                                                   | Description                          |
| -------------------- | ------------------------------------------------------ | ------------------------------------ |
| `copy`               | `(event: React.MouseEvent<HTMLButtonElement>) => void` | Function to trigger copy operation   |
| `recentlySuccessful` | `boolean`                                              | Whether copy was recently successful |

## Usage Examples

### Basic Copy Button

```tsx
import { useCopier } from '@mui/internal-docs-infra/useCopier';

function CopyButton({ text }: { text: string }) {
  const { copy, recentlySuccessful } = useCopier(text);

  return <button onClick={copy}>{recentlySuccessful ? 'Copied!' : 'Copy'}</button>;
}
```

### Dynamic Content

```tsx
import { useCopier } from '@mui/internal-docs-infra/useCopier';

function CodeBlockCopy({ getCode }: { getCode: () => string }) {
  const { copy, recentlySuccessful } = useCopier(getCode);

  return (
    <button onClick={copy} disabled={recentlySuccessful}>
      {recentlySuccessful ? 'âœ“ Copied' : 'Copy Code'}
    </button>
  );
}
```

### With Error Handling

```tsx
import { useCopier } from '@mui/internal-docs-infra/useCopier';

function CopyWithFeedback({ content }: { content: string }) {
  const [error, setError] = React.useState<string | null>(null);

  const { copy, recentlySuccessful } = useCopier(content, {
    onCopied: () => setError(null),
    onError: (err) => setError('Failed to copy to clipboard'),
    timeout: 3000,
  });

  return (
    <div>
      <button onClick={copy}>{recentlySuccessful ? 'Copied!' : 'Copy'}</button>
      {error && <span style={{ color: 'red' }}>{error}</span>}
    </div>
  );
}
```

### With Custom Analytics

```tsx
import { useCopier } from '@mui/internal-docs-infra/useCopier';

function AnalyticsCopyButton({ text, label }: { text: string; label: string }) {
  const { copy, recentlySuccessful } = useCopier(text, {
    onCopied: () => {
      // Track successful copy events
      analytics.track('Code Copied', { label });
    },
    onError: (error) => {
      // Track copy failures
      analytics.track('Copy Failed', { label, error: String(error) });
    },
    onClick: (event) => {
      // Track all copy attempts
      analytics.track('Copy Attempted', { label });
    },
  });

  return (
    <button onClick={copy} className={recentlySuccessful ? 'success' : ''}>
      {recentlySuccessful ? 'Copied!' : `Copy ${label}`}
    </button>
  );
}
```

### Integration with Code Highlighter

```tsx
import { useCopier } from '@mui/internal-docs-infra/useCopier';
import { CodeHighlighter } from '@mui/internal-docs-infra/CodeHighlighter';

function CodeBlockWithCopy({ code, language }: { code: string; language: string }) {
  const { copy, recentlySuccessful } = useCopier(() => {
    // Get the current code, potentially from a transformed state
    return getCurrentCode();
  });

  return (
    <div className="code-block">
      <div className="code-header">
        <span>{language}</span>
        <button onClick={copy} className="copy-button">
          {recentlySuccessful ? <>âœ“ Copied</> : <>ðŸ“‹ Copy</>}
        </button>
      </div>
      <CodeHighlighter code={code} language={language} />
    </div>
  );
}
```

## How It Works

1. **Content Resolution**: When `copy` is called, resolves content from string or function
2. **Clipboard API**: Uses the `clipboard-copy` library for cross-browser compatibility
3. **Success State**: Sets `recentlySuccessful` to `true` after successful copy
4. **Timeout Management**: Automatically resets success state after configured timeout
5. **Cleanup**: Clears timeouts to prevent memory leaks

## State Management

The hook manages internal state for copy feedback:

- **Initial state**: `recentlySuccessful` is `false`
- **On copy attempt**: State resets to `false` and clears any existing timeout
- **On success**: State becomes `true` and starts timeout countdown
- **After timeout**: State resets to `false`
- **On error**: State remains `false` but error callback is fired

## Error Handling

Copy operations can fail for various reasons:

- **Security restrictions**: Some browsers require user interaction
- **Permission denied**: Clipboard access may be blocked
- **Empty content**: No content to copy (function returns undefined)

The hook provides the `onError` callback to handle these cases gracefully.

## TypeScript Support

The hook is fully typed with proper TypeScript definitions:

```typescript
export type UseCopierOpts = {
  onCopied?: () => void;
  onError?: (error: unknown) => void;
  onClick?: (event: React.MouseEvent<HTMLButtonElement>) => void;
  timeout?: number;
};

export function useCopier(
  contents: (() => string | undefined) | string,
  opts?: UseCopierOpts,
): {
  copy: (event: React.MouseEvent<HTMLButtonElement>) => void;
  recentlySuccessful: boolean;
};
```

## When to Use

- **Code blocks** - Copy source code, commands, or configurations
- **Documentation** - Copy API endpoints, package names, or examples
- **Interactive demos** - Copy generated output or current state
- **Forms** - Copy generated URLs, tokens, or formatted data
- **Any UI element** - That benefits from copy-to-clipboard functionality

## Browser Support

Uses the `clipboard-copy` library which provides:

- Modern `navigator.clipboard.writeText()` API when available
- Fallback to `document.execCommand('copy')` for older browsers
- Works in both secure (HTTPS) and insecure contexts

## Related

- [`CodeHighlighter`](../../components/code-highlighter/page.mdx) - Often used together for code copy functionality
- [clipboard-copy](https://www.npmjs.com/package/clipboard-copy) - Underlying clipboard library
